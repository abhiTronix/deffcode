<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A High-performance Real-time Video frames Generator for generating blazingly fast video frames in python 🔥"><meta name=author content="Abhishek Thakur"><link href=https://abhitronix.github.io/deffcode/v0.2.5-stable/recipes/advanced/decode-hw-acceleration/ rel=canonical><link href=../decode-live-feed-devices/ rel=prev><link href=../transcode-live-frames-complexgraphs/ rel=next><link rel=icon href=../../../assets/images/favicon-32x32.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.3"><title>Hardware-Accelerated Video Decoding - DeFFcode</title><link rel=stylesheet href=../../../assets/stylesheets/main.6b71719e.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.2505c338.min.css><script src=https://sidecar.gitter.im/dist/sidecar.v1.js async defer></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Libre+Franklin:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Libre Franklin";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../assets/stylesheets/custom.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-131929464-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");ga("send","event","feedback","click",t,e),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){ga("send","pageview",e.pathname)})});var e=document.createElement("script");e.async=!0,e.src="https://www.google-analytics.com/analytics.js",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta property=og:type content=website><meta property=og:title content="DeFFcode - Hardware-Accelerated Video Decoding"><meta property=og:description content="A High-performance Real-time Video frames Generator for generating blazingly fast video frames in python 🔥"><meta content=https://abhitronix.github.io/deffcode/v0.2.5-stable/recipes/advanced/decode-hw-acceleration/ property=og:url><meta property=og:image content=https://abhitronix.github.io/deffcode/v0.2.5-stable/assets/images/decode-banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@abhi_una12><meta name=twitter:creator content=@abhi_una12><meta name=twitter:title content="DeFFcode - Hardware-Accelerated Video Decoding"><meta name=twitter:description content="A High-performance Real-time Video frames Generator for generating blazingly fast video frames in python 🔥"><meta name=twitter:image content=https://abhitronix.github.io/deffcode/v0.2.5-stable/assets/images/decode-banner.png></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=light-green data-md-color-accent=green> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#hardware-accelerated-video-decoding class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <!-- Add announcement here, including arbitrary HTML --> <b>Hey, Index based Camera Device Capture support has been added in <code>v0.2.4</code>. Checkout these <a href=https://abhitronix.github.io/deffcode/v0.2.5-stable/recipes/basic/decode-camera-devices/#decoding-camera-devices-using-indexes>new recipes <span class=twemoji> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8 1.5a3.35 3.35 0 0 0 0 6.7h1.53c.39 0 .76.1 1.08.3h2.02c-.58-1.05-1.77-1.75-3.1-1.75H8c-1 0-1.85-.98-1.85-2S7 3 8 3V1.5m4.85.5c0 1-.85 1.85-1.85 1.85v1.5c1.92 0 3.5 1.35 3.89 3.15h1.53a5.541 5.541 0 0 0-3.07-4.12c.62-.61 1-1.45 1-2.38h-1.5M3 10v2h2v7a2 2 0 0 0 2 2h10c1.11 0 2-.89 2-2v-7h2v-2H3m4 2h10v7H7v-7Z"/></svg> </span> ➶</a></b> </div> </aside> </div> <div data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=DeFFcode class="md-header__button md-logo" aria-label=DeFFcode data-md-component=logo> <img src=../../../assets/images/android-chrome-192x192.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DeFFcode </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Hardware-Accelerated Video Decoding </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=light-green data-md-color-accent=green aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M112.1 454.3c0 6.297 1.816 12.44 5.284 17.69l17.14 25.69c5.25 7.875 17.17 14.28 26.64 14.28h61.67c9.438 0 21.36-6.401 26.61-14.28l17.08-25.68c2.938-4.438 5.348-12.37 5.348-17.7l.128-39.2H112l.1 39.2zM192 0C90.02.32 16 82.97 16 175.1c0 44.38 16.44 84.84 43.56 115.8 16.53 18.84 42.34 58.23 52.22 91.45.031.25.094.517.125.782h160.2c.031-.265.094-.516.125-.782 9.875-33.22 35.69-72.61 52.22-91.45C351.6 260.8 368 220.4 368 175.1 368 78.8 289.2.004 192 0zm96.4 260.1c-15.66 17.85-35.04 46.3-49.05 75.89h-94.61c-14.01-29.59-33.39-58.04-49.04-75.88C75.24 236.8 64 206.1 64 175.1 64 113.3 112.1 48.25 191.1 48 262.6 48 320 105.4 320 175.1c0 31-11.2 61.7-31.6 85zM176 80c-44.1 0-80 35.9-80 80 0 8.844 7.156 16 16 16s16-7.2 16-16c0-26.47 21.53-48 48-48 8.844 0 16-7.148 16-15.99S184.8 80 176 80z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=amber data-md-color-accent=lime aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M272 384c9.6-31.9 29.5-59.1 49.2-86.2 5.2-7.1 10.4-14.2 15.4-21.4 19.8-28.5 31.4-63 31.4-100.3C368 78.8 289.2 0 192 0S16 78.8 16 176c0 37.3 11.6 71.9 31.4 100.3 5 7.2 10.2 14.3 15.4 21.4 19.8 27.1 39.7 54.4 49.2 86.2h160zm-80 128c44.2 0 80-35.8 80-80v-16H112v16c0 44.2 35.8 80 80 80zm-80-336c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112 8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/abhiTronix/deffcode title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> abhiTronix/deffcode </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../basic/ class="md-tabs__link md-tabs__link--active"> Recipies </a> </li> <li class=md-tabs__item> <a href=../../../reference/ffdecoder/ class=md-tabs__link> API References </a> </li> <li class=md-tabs__item> <a href=../../../help/ class=md-tabs__link> Help Section </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=DeFFcode class="md-nav__button md-logo" aria-label=DeFFcode data-md-component=logo> <img src=../../../assets/images/android-chrome-192x192.png alt=logo> </a> DeFFcode </label> <div class=md-nav__source> <a href=https://github.com/abhiTronix/deffcode title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> abhiTronix/deffcode </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 tabindex=0 aria-expanded=false> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_1_1 type=checkbox id=__nav_1_1> <div class="md-nav__link md-nav__link--index "> <a href=../../..>Introduction</a> </div> <nav class=md-nav aria-label=Introduction data-md-level=2> <label class=md-nav__title for=__nav_1_1> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_1_2 type=checkbox id=__nav_1_2> <div class="md-nav__link md-nav__link--index "> <a href=../../../installation/ >Installation Notes</a> <label for=__nav_1_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Installation Notes" data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Installation Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../installation/ffmpeg_install/ class=md-nav__link> FFmpeg Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_1_3 type=checkbox id=__nav_1_3> <div class="md-nav__link md-nav__link--index "> <a href=../../../contribution/ >Contribution Guidelines</a> <label for=__nav_1_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Contribution Guidelines" data-md-level=2> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Contribution Guidelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../contribution/issue/ class=md-nav__link> Issue Guidelines </a> </li> <li class=md-nav__item> <a href=../../../contribution/PR/ class=md-nav__link> Pull Request(PR) Guidelines </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../changelog/ class=md-nav__link> Changelog </a> </li> <li class=md-nav__item> <a href=../../../license/ class=md-nav__link> License </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 tabindex=0 aria-expanded=true> Recipies <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Recipies data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Recipies </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_2_1 type=checkbox id=__nav_2_1> <div class="md-nav__link md-nav__link--index "> <a href=../../basic/ >Basic Recipes</a> <label for=__nav_2_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Basic Recipes" data-md-level=2> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Basic Recipes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic/decode-video-files/ class=md-nav__link> Decoding Video Files </a> </li> <li class=md-nav__item> <a href=../../basic/decode-camera-devices/ class=md-nav__link> Decoding Camera Devices </a> </li> <li class=md-nav__item> <a href=../../basic/decode-network-streams/ class=md-nav__link> Decoding Network Streams </a> </li> <li class=md-nav__item> <a href=../../basic/decode-image-sequences/ class=md-nav__link> Decoding Image sequences </a> </li> <li class=md-nav__item> <a href=../../basic/transcode-live-frames/ class=md-nav__link> Transcoding Live frames </a> </li> <li class=md-nav__item> <a href=../../basic/transcode-live-frames-simplegraphs/ class=md-nav__link> Transcoding Live Simple Filtergraphs </a> </li> <li class=md-nav__item> <a href=../../basic/save-keyframe-image/ class=md-nav__link> Saving Key-frames as Image </a> </li> <li class=md-nav__item> <a href=../../basic/extract-video-metadata/ class=md-nav__link> Extracting video metadata </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2 checked> <div class="md-nav__link md-nav__link--index "> <a href=../ >Advanced Recipies</a> <label for=__nav_2_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Advanced Recipies" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Advanced Recipies </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../decode-live-virtual-sources/ class=md-nav__link> Decoding Live Virtual Sources </a> </li> <li class=md-nav__item> <a href=../decode-live-feed-devices/ class=md-nav__link> Decoding Live Feed Devices </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Hardware-Accelerated Video Decoding <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Hardware-Accelerated Video Decoding </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#cuvid-accelerated-hardware-based-video-decoding-and-previewing class=md-nav__link> CUVID-accelerated Hardware-based Video Decoding and Previewing </a> </li> <li class=md-nav__item> <a href=#cuda-accelerated-hardware-based-video-decoding-and-previewing class=md-nav__link> CUDA-accelerated Hardware-based Video Decoding and Previewing </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../transcode-live-frames-complexgraphs/ class=md-nav__link> Transcoding Live Complex Filtergraphs </a> </li> <li class=md-nav__item> <a href=../transcode-art-filtergraphs/ class=md-nav__link> Transcoding Video Art with Filtergraphs </a> </li> <li class=md-nav__item> <a href=../transcode-hw-acceleration/ class=md-nav__link> Hardware-Accelerated Video Transcoding </a> </li> <li class=md-nav__item> <a href=../update-metadata/ class=md-nav__link> Updating Video Metadata </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 tabindex=0 aria-expanded=false> API References <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="API References" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> API References </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_3_1 type=checkbox id=__nav_3_1> <div class="md-nav__link md-nav__link--index "> <a href=../../../reference/ffdecoder/ >deffcode.FFdecoder</a> <label for=__nav_3_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=deffcode.FFdecoder data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> deffcode.FFdecoder </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/ffdecoder/params/ class=md-nav__link> API Parameters </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <div class="md-nav__link md-nav__link--index "> <a href=../../../reference/sourcer/ >deffcode.Sourcer</a> <label for=__nav_3_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=deffcode.Sourcer data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> deffcode.Sourcer </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../reference/sourcer/params/ class=md-nav__link> API Parameters </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../reference/ffhelper/ class=md-nav__link> deffcode.ffhelper </a> </li> <li class=md-nav__item> <a href=../../../reference/utils/ class=md-nav__link> deffcode.utils </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 tabindex=0 aria-expanded=false> Help Section <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Help Section" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Help Section </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../help/ class=md-nav__link> Help Us </a> </li> <li class=md-nav__item> <a href=../../../help/get_help/ class=md-nav__link> Get Help </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#cuvid-accelerated-hardware-based-video-decoding-and-previewing class=md-nav__link> CUVID-accelerated Hardware-based Video Decoding and Previewing </a> </li> <li class=md-nav__item> <a href=#cuda-accelerated-hardware-based-video-decoding-and-previewing class=md-nav__link> CUDA-accelerated Hardware-based Video Decoding and Previewing </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=hardware-accelerated-video-decoding><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M6.5.75V2h3V.75a.75.75 0 0 1 1.5 0V2h1.25c.966 0 1.75.784 1.75 1.75V5h1.25a.75.75 0 0 1 0 1.5H14v3h1.25a.75.75 0 0 1 0 1.5H14v1.25A1.75 1.75 0 0 1 12.25 14H11v1.25a.75.75 0 0 1-1.5 0V14h-3v1.25a.75.75 0 0 1-1.5 0V14H3.75A1.75 1.75 0 0 1 2 12.25V11H.75a.75.75 0 0 1 0-1.5H2v-3H.75a.75.75 0 0 1 0-1.5H2V3.75C2 2.784 2.784 2 3.75 2H5V.75a.75.75 0 0 1 1.5 0zm5.75 11.75a.25.25 0 0 0 .25-.25v-8.5a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25zM5.75 5h4.5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-.75.75h-4.5a.75.75 0 0 1-.75-.75v-4.5A.75.75 0 0 1 5.75 5zm.75 4.5h3v-3h-3z"/></svg></span> Hardware-Accelerated Video Decoding<a class=headerlink href=#hardware-accelerated-video-decoding title="Anchor link to this section for reference">&para;</a></h1> <div class="admonition abstract"> <p class=admonition-title>FFmpeg offer access to dedicated GPU hardware with varying support on different platforms for performing a range of video-related tasks to be completed faster or using less of other resources (particularly CPU).</p> </div> <blockquote> <p>By default, DeFFcode's FFdecoder API uses the Input Source's video-decoder <em>(extracted using Sourcer API)</em> itself for decoding its input. However, you could easily change the video-decoder to your desired specific <strong>supported Video-Decoder</strong> using FFmpeg options by way of its <a href=../../reference/ffdecoder/params/#ffparams><code>ffparams</code></a> dictionary parameter. This feature provides easy access to GPU Accelerated Hardware Decoder in FFdecoder API that will generate faster video frames<img alt=⚡ class=twemoji src=https://twemoji.maxcdn.com/v/latest/svg/26a1.svg title=:zap:> while using little to no CPU power, as opposed to CPU intensive Software Decoders.</p> </blockquote> <p>We'll discuss its Hardware-Accelerated Video Decoding capabilities briefly in the following recipes:</p> <p>&thinsp;</p> <div class="admonition warning"> <p class=admonition-title>DeFFcode APIs requires FFmpeg executable</p> <p><mark>DeFFcode APIs <strong>MUST</strong> requires valid FFmpeg executable for all of its core functionality</mark>, and any failure in detection will raise <code>RuntimeError</code> immediately. Follow dedicated <a href=../../../installation/ffmpeg_install/ >FFmpeg Installation doc ➶</a> for its installation.</p> </div> <details class=info> <summary>Additional Python Dependencies for following recipes</summary> <p>Following recipes requires additional python dependencies which can be installed easily as below:</p> <ul class=task-list> <li class=task-list-item> <p><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> <strong>OpenCV:</strong> OpenCV is required for previewing video frames. You can easily install it directly via <a href=https://pypi.org/project/opencv-python/ ><code>pip</code></a>:</p> <details class=tip> <summary>OpenCV installation from source</summary> <p>You can also follow online tutorials for building &amp; installing OpenCV on <a href=https://www.learnopencv.com/install-opencv3-on-windows/ >Windows</a>, <a href=https://www.pyimagesearch.com/2018/05/28/ubuntu-18-04-how-to-install-opencv/ >Linux</a>, <a href=https://www.pyimagesearch.com/2018/08/17/install-opencv-4-on-macos/ >MacOS</a> and <a href=https://www.pyimagesearch.com/2018/09/26/install-opencv-4-on-your-raspberry-pi/ >Raspberry Pi</a> machines manually from its source. </p> <p><img alt=⚠ class=twemoji src=https://twemoji.maxcdn.com/v/latest/svg/26a0.svg title=:warning:> Make sure not to install both <em>pip</em> and <em>source</em> version together. Otherwise installation will fail to work!</p> </details> <details class=info> <summary>Other OpenCV binaries</summary> <p>OpenCV maintainers also provide additional binaries via pip that contains both main modules and contrib/extra modules <a href=https://pypi.org/project/opencv-contrib-python/ ><code>opencv-contrib-python</code></a>, and for server (headless) environments like <a href=https://pypi.org/project/opencv-python-headless/ ><code>opencv-python-headless</code></a> and <a href=https://pypi.org/project/opencv-contrib-python-headless/ ><code>opencv-contrib-python-headless</code></a>. You can also install <mark>any one of them</mark> in similar manner. More information can be found <a href=https://github.com/opencv/opencv-python#installation-and-usage>here</a>.</p> </details> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>pip<span class=w> </span>install<span class=w> </span>opencv-python<span class=w>       </span>
</code></pre></div> </li> </ul> </details> <div class="admonition note"> <p class=admonition-title>Always use FFdecoder API's <a href=../../reference/ffdecoder/#deffcode.ffdecoder.FFdecoder.terminate><code>terminate()</code></a> method at the end to avoid undesired behavior.</p> </div> <details class=danger> <summary>Never name your python script <code>deffcode.py</code></summary> <p>When trying out these recipes, never name your python script <code>deffcode.py</code> otherwise it will result in <code>ModuleNotFound</code> error.</p> </details> <p>&thinsp;</p> <h2 id=cuvid-accelerated-hardware-based-video-decoding-and-previewing>CUVID-accelerated Hardware-based Video Decoding and Previewing<a class=headerlink href=#cuvid-accelerated-hardware-based-video-decoding-and-previewing title="Anchor link to this section for reference">&para;</a></h2> <details class=alert open=open> <summary>Example Assumptions</summary> <p><strong>Please note that following recipe explicitly assumes:</strong></p> <ul class=task-list> <li>You're running <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M220.8 123.3c1 .5 1.8 1.7 3 1.7 1.1 0 2.8-.4 2.9-1.5.2-1.4-1.9-2.3-3.2-2.9-1.7-.7-3.9-1-5.5-.1-.4.2-.8.7-.6 1.1.3 1.3 2.3 1.1 3.4 1.7zm-21.9 1.7c1.2 0 2-1.2 3-1.7 1.1-.6 3.1-.4 3.5-1.6.2-.4-.2-.9-.6-1.1-1.6-.9-3.8-.6-5.5.1-1.3.6-3.4 1.5-3.2 2.9.1 1 1.8 1.5 2.8 1.4zM420 403.8c-3.6-4-5.3-11.6-7.2-19.7-1.8-8.1-3.9-16.8-10.5-22.4-1.3-1.1-2.6-2.1-4-2.9-1.3-.8-2.7-1.5-4.1-2 9.2-27.3 5.6-54.5-3.7-79.1-11.4-30.1-31.3-56.4-46.5-74.4-17.1-21.5-33.7-41.9-33.4-72C311.1 85.4 315.7.1 234.8 0 132.4-.2 158 103.4 156.9 135.2c-1.7 23.4-6.4 41.8-22.5 64.7-18.9 22.5-45.5 58.8-58.1 96.7-6 17.9-8.8 36.1-6.2 53.3-6.5 5.8-11.4 14.7-16.6 20.2-4.2 4.3-10.3 5.9-17 8.3s-14 6-18.5 14.5c-2.1 3.9-2.8 8.1-2.8 12.4 0 3.9.6 7.9 1.2 11.8 1.2 8.1 2.5 15.7.8 20.8-5.2 14.4-5.9 24.4-2.2 31.7 3.8 7.3 11.4 10.5 20.1 12.3 17.3 3.6 40.8 2.7 59.3 12.5 19.8 10.4 39.9 14.1 55.9 10.4 11.6-2.6 21.1-9.6 25.9-20.2 12.5-.1 26.3-5.4 48.3-6.6 14.9-1.2 33.6 5.3 55.1 4.1.6 2.3 1.4 4.6 2.5 6.7v.1c8.3 16.7 23.8 24.3 40.3 23 16.6-1.3 34.1-11 48.3-27.9 13.6-16.4 36-23.2 50.9-32.2 7.4-4.5 13.4-10.1 13.9-18.3.4-8.2-4.4-17.3-15.5-29.7zM223.7 87.3c9.8-22.2 34.2-21.8 44-.4 6.5 14.2 3.6 30.9-4.3 40.4-1.6-.8-5.9-2.6-12.6-4.9 1.1-1.2 3.1-2.7 3.9-4.6 4.8-11.8-.2-27-9.1-27.3-7.3-.5-13.9 10.8-11.8 23-4.1-2-9.4-3.5-13-4.4-1-6.9-.3-14.6 2.9-21.8zM183 75.8c10.1 0 20.8 14.2 19.1 33.5-3.5 1-7.1 2.5-10.2 4.6 1.2-8.9-3.3-20.1-9.6-19.6-8.4.7-9.8 21.2-1.8 28.1 1 .8 1.9-.2-5.9 5.5-15.6-14.6-10.5-52.1 8.4-52.1zm-13.6 60.7c6.2-4.6 13.6-10 14.1-10.5 4.7-4.4 13.5-14.2 27.9-14.2 7.1 0 15.6 2.3 25.9 8.9 6.3 4.1 11.3 4.4 22.6 9.3 8.4 3.5 13.7 9.7 10.5 18.2-2.6 7.1-11 14.4-22.7 18.1-11.1 3.6-19.8 16-38.2 14.9-3.9-.2-7-1-9.6-2.1-8-3.5-12.2-10.4-20-15-8.6-4.8-13.2-10.4-14.7-15.3-1.4-4.9 0-9 4.2-12.3zm3.3 334c-2.7 35.1-43.9 34.4-75.3 18-29.9-15.8-68.6-6.5-76.5-21.9-2.4-4.7-2.4-12.7 2.6-26.4v-.2c2.4-7.6.6-16-.6-23.9-1.2-7.8-1.8-15 .9-20 3.5-6.7 8.5-9.1 14.8-11.3 10.3-3.7 11.8-3.4 19.6-9.9 5.5-5.7 9.5-12.9 14.3-18 5.1-5.5 10-8.1 17.7-6.9 8.1 1.2 15.1 6.8 21.9 16l19.6 35.6c9.5 19.9 43.1 48.4 41 68.9zm-1.4-25.9c-4.1-6.6-9.6-13.6-14.4-19.6 7.1 0 14.2-2.2 16.7-8.9 2.3-6.2 0-14.9-7.4-24.9-13.5-18.2-38.3-32.5-38.3-32.5-13.5-8.4-21.1-18.7-24.6-29.9s-3-23.3-.3-35.2c5.2-22.9 18.6-45.2 27.2-59.2 2.3-1.7.8 3.2-8.7 20.8-8.5 16.1-24.4 53.3-2.6 82.4.6-20.7 5.5-41.8 13.8-61.5 12-27.4 37.3-74.9 39.3-112.7 1.1.8 4.6 3.2 6.2 4.1 4.6 2.7 8.1 6.7 12.6 10.3 12.4 10 28.5 9.2 42.4 1.2 6.2-3.5 11.2-7.5 15.9-9 9.9-3.1 17.8-8.6 22.3-15 7.7 30.4 25.7 74.3 37.2 95.7 6.1 11.4 18.3 35.5 23.6 64.6 3.3-.1 7 .4 10.9 1.4 13.8-35.7-11.7-74.2-23.3-84.9-4.7-4.6-4.9-6.6-2.6-6.5 12.6 11.2 29.2 33.7 35.2 59 2.8 11.6 3.3 23.7.4 35.7 16.4 6.8 35.9 17.9 30.7 34.8-2.2-.1-3.2 0-4.2 0 3.2-10.1-3.9-17.6-22.8-26.1-19.6-8.6-36-8.6-38.3 12.5-12.1 4.2-18.3 14.7-21.4 27.3-2.8 11.2-3.6 24.7-4.4 39.9-.5 7.7-3.6 18-6.8 29-32.1 22.9-76.7 32.9-114.3 7.2zm257.4-11.5c-.9 16.8-41.2 19.9-63.2 46.5-13.2 15.7-29.4 24.4-43.6 25.5s-26.5-4.8-33.7-19.3c-4.7-11.1-2.4-23.1 1.1-36.3 3.7-14.2 9.2-28.8 9.9-40.6.8-15.2 1.7-28.5 4.2-38.7 2.6-10.3 6.6-17.2 13.7-21.1.3-.2.7-.3 1-.5.8 13.2 7.3 26.6 18.8 29.5 12.6 3.3 30.7-7.5 38.4-16.3 9-.3 15.7-.9 22.6 5.1 9.9 8.5 7.1 30.3 17.1 41.6 10.6 11.6 14 19.5 13.7 24.6zM173.3 148.7c2 1.9 4.7 4.5 8 7.1 6.6 5.2 15.8 10.6 27.3 10.6 11.6 0 22.5-5.9 31.8-10.8 4.9-2.6 10.9-7 14.8-10.4s5.9-6.3 3.1-6.6-2.6 2.6-6 5.1c-4.4 3.2-9.7 7.4-13.9 9.8-7.4 4.2-19.5 10.2-29.9 10.2s-18.7-4.8-24.9-9.7c-3.1-2.5-5.7-5-7.7-6.9-1.5-1.4-1.9-4.6-4.3-4.9-1.4-.1-1.8 3.7 1.7 6.5z"/></svg></span> Linux operating system with a <a href=https://developer.nvidia.com/nvidia-video-codec-sdk><strong>supported NVIDIA GPU</strong></a>.</li> <li> <p>You're using FFmpeg 4.4 or newer, configured with at least <code>--enable-nonfree --enable-cuda-nvcc --enable-libnpp --enable-cuvid --enable-nvenc</code> configuration flags during compilation. For compilation follow <a href=https://docs.nvidia.com/video-technologies/video-codec-sdk/ffmpeg-with-nvidia-gpu/#prerequisites>these instructions ➶</a></p> </li> <li class=task-list-item> <p><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> <strong>Using <code>h264_cuvid</code> decoder</strong>: Remember to check if your FFmpeg compiled with H.264 CUVID decoder support by executing following one-liner command in your terminal, and observing if output contains something similar as follows:</p> <details class=danger> <summary>Verifying H.264 CUVID decoder support in FFmpeg</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>$<span class=w> </span>ffmpeg<span class=w>  </span>-hide_banner<span class=w> </span>-decoders<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>cuvid
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>V.....<span class=w> </span>av1_cuvid<span class=w>            </span>Nvidia<span class=w> </span>CUVID<span class=w> </span>AV1<span class=w> </span>decoder<span class=w> </span><span class=o>(</span>codec<span class=w> </span>av1<span class=o>)</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>V.....<span class=w> </span>h264_cuvid<span class=w>           </span>Nvidia<span class=w> </span>CUVID<span class=w> </span>H264<span class=w> </span>decoder<span class=w> </span><span class=o>(</span>codec<span class=w> </span>h264<span class=o>)</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>V.....<span class=w> </span>hevc_cuvid<span class=w>           </span>Nvidia<span class=w> </span>CUVID<span class=w> </span>HEVC<span class=w> </span>decoder<span class=w> </span><span class=o>(</span>codec<span class=w> </span>hevc<span class=o>)</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>V.....<span class=w> </span>mjpeg_cuvid<span class=w>          </span>Nvidia<span class=w> </span>CUVID<span class=w> </span>MJPEG<span class=w> </span>decoder<span class=w> </span><span class=o>(</span>codec<span class=w> </span>mjpeg<span class=o>)</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>V.....<span class=w> </span>mpeg1_cuvid<span class=w>          </span>Nvidia<span class=w> </span>CUVID<span class=w> </span>MPEG1VIDEO<span class=w> </span>decoder<span class=w> </span><span class=o>(</span>codec<span class=w> </span>mpeg1video<span class=o>)</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>V.....<span class=w> </span>mpeg2_cuvid<span class=w>          </span>Nvidia<span class=w> </span>CUVID<span class=w> </span>MPEG2VIDEO<span class=w> </span>decoder<span class=w> </span><span class=o>(</span>codec<span class=w> </span>mpeg2video<span class=o>)</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>V.....<span class=w> </span>mpeg4_cuvid<span class=w>          </span>Nvidia<span class=w> </span>CUVID<span class=w> </span>MPEG4<span class=w> </span>decoder<span class=w> </span><span class=o>(</span>codec<span class=w> </span>mpeg4<span class=o>)</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>V.....<span class=w> </span>vc1_cuvid<span class=w>            </span>Nvidia<span class=w> </span>CUVID<span class=w> </span>VC1<span class=w> </span>decoder<span class=w> </span><span class=o>(</span>codec<span class=w> </span>vc1<span class=o>)</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>V.....<span class=w> </span>vp8_cuvid<span class=w>            </span>Nvidia<span class=w> </span>CUVID<span class=w> </span>VP8<span class=w> </span>decoder<span class=w> </span><span class=o>(</span>codec<span class=w> </span>vp8<span class=o>)</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>V.....<span class=w> </span>vp9_cuvid<span class=w>            </span>Nvidia<span class=w> </span>CUVID<span class=w> </span>VP9<span class=w> </span>decoder<span class=w> </span><span class=o>(</span>codec<span class=w> </span>vp9<span class=o>)</span>
</code></pre></div> <div class="admonition note"> <p class=admonition-title>You can also use any of above decoder in the similar way, if supported.</p> </div> <div class="admonition tip"> <p class=admonition-title>Use <code class=highlight>ffmpeg<span class=w> </span>-decoders</code> terminal command to lists all FFmpeg supported decoders.</p> </div> </details> </li> <li> <p>You already have appropriate Nvidia video drivers and related softwares installed on your machine.</p> </li> <li>If the stream is not decodable in hardware (for example, it is an unsupported codec or profile) then it will still be decoded in software automatically, but hardware filters won't be applicable.</li> </ul> <p>These assumptions <strong>MAY/MAY NOT</strong> suit your current setup. Kindly use suitable parameters based your system platform and hardware settings only.</p> </details> <p>In this example, we will be using Nvidia's <strong>H.264 CUVID Video decoder</strong> in FFdecoder API to achieve GPU-accelerated hardware video decoding of <strong>YUV420p</strong> frames from a given Video file <em>(say <code>foo.mp4</code>)</em>, and preview them using OpenCV Library's <code>cv2.imshow()</code> method.</p> <div class="admonition note"> <p class=admonition-title>With FFdecoder API, frames extracted with YUV pixel formats <em>(<code>yuv420p</code>, <code>yuv444p</code>, <code>nv12</code>, <code>nv21</code> etc.)</em> are generally incompatible with OpenCV APIs such as <code>imshow()</code>. But you can make them easily compatible by using exclusive <a href=../../reference/ffdecoder/params/#b-exclusive-parameters><code>-enforce_cv_patch</code></a> boolean attribute of its <code>ffparam</code> dictionary parameter.</p> </div> <div class="admonition info"> <p class=admonition-title>More information on Nvidia's CUVID can be found <a href=https://developer.nvidia.com/blog/nvidia-ffmpeg-transcoding-guide/ >here ➶</a></p> </div> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># import the necessary packages</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=kn>from</span> <span class=nn>deffcode</span> <span class=kn>import</span> <span class=n>FFdecoder</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=kn>import</span> <span class=nn>cv2</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=c1># define suitable FFmpeg parameter</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=n>ffparams</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>    <span class=s2>&quot;-vcodec&quot;</span><span class=p>:</span> <span class=s2>&quot;h264_cuvid&quot;</span><span class=p>,</span>  <span class=c1># use H.264 CUVID Video-decoder</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>    <span class=s2>&quot;-enforce_cv_patch&quot;</span><span class=p>:</span> <span class=kc>True</span> <span class=c1># enable OpenCV patch for YUV(YUV420p) frames</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=p>}</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=c1># initialize and formulate the decoder with `foo.mp4` source</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=n>decoder</span> <span class=o>=</span> <span class=n>FFdecoder</span><span class=p>(</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>    <span class=s2>&quot;foo.mp4&quot;</span><span class=p>,</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>    <span class=n>frame_format</span><span class=o>=</span><span class=s2>&quot;yuv420p&quot;</span><span class=p>,</span>  <span class=c1># use YUV420p frame pixel format</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>    <span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=c1># enable verbose output</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>    <span class=o>**</span><span class=n>ffparams</span> <span class=c1># apply various params and custom filters</span>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=p>)</span><span class=o>.</span><span class=n>formulate</span><span class=p>()</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=c1># grab the YUV420p frame from the decoder</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=k>for</span> <span class=n>frame</span> <span class=ow>in</span> <span class=n>decoder</span><span class=o>.</span><span class=n>generateFrame</span><span class=p>():</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>    <span class=c1># check if frame is None</span>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>    <span class=k>if</span> <span class=n>frame</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>        <span class=k>break</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>    <span class=c1># convert it to `BGR` pixel format,</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>    <span class=c1># since imshow() method only accepts `BGR` frames</span>
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>    <span class=n>frame</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>frame</span><span class=p>,</span> <span class=n>cv2</span><span class=o>.</span><span class=n>COLOR_YUV2BGR_I420</span><span class=p>)</span>
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>    <span class=c1># {do something with the BGR frame here}</span>
<a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>
<a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a>    <span class=c1># Show output window</span>
<a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a>    <span class=n>cv2</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=s2>&quot;Output&quot;</span><span class=p>,</span> <span class=n>frame</span><span class=p>)</span>
<a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>
<a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a>    <span class=c1># check for &#39;q&#39; key if pressed</span>
<a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a>    <span class=n>key</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>waitKey</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>
<a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a>    <span class=k>if</span> <span class=n>key</span> <span class=o>==</span> <span class=nb>ord</span><span class=p>(</span><span class=s2>&quot;q&quot;</span><span class=p>):</span>
<a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a>        <span class=k>break</span>
<a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a>
<a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a><span class=c1># close output window</span>
<a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a><span class=n>cv2</span><span class=o>.</span><span class=n>destroyAllWindows</span><span class=p>()</span>
<a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a>
<a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a><span class=c1># terminate the decoder</span>
<a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a><span class=n>decoder</span><span class=o>.</span><span class=n>terminate</span><span class=p>()</span>
</code></pre></div> <p>&nbsp;</p> <h2 id=cuda-accelerated-hardware-based-video-decoding-and-previewing>CUDA-accelerated Hardware-based Video Decoding and Previewing<a class=headerlink href=#cuda-accelerated-hardware-based-video-decoding-and-previewing title="Anchor link to this section for reference">&para;</a></h2> <details class=alert open=open> <summary>Example Assumptions</summary> <p><strong>Please note that following recipe explicitly assumes:</strong></p> <ul> <li>You're running <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M220.8 123.3c1 .5 1.8 1.7 3 1.7 1.1 0 2.8-.4 2.9-1.5.2-1.4-1.9-2.3-3.2-2.9-1.7-.7-3.9-1-5.5-.1-.4.2-.8.7-.6 1.1.3 1.3 2.3 1.1 3.4 1.7zm-21.9 1.7c1.2 0 2-1.2 3-1.7 1.1-.6 3.1-.4 3.5-1.6.2-.4-.2-.9-.6-1.1-1.6-.9-3.8-.6-5.5.1-1.3.6-3.4 1.5-3.2 2.9.1 1 1.8 1.5 2.8 1.4zM420 403.8c-3.6-4-5.3-11.6-7.2-19.7-1.8-8.1-3.9-16.8-10.5-22.4-1.3-1.1-2.6-2.1-4-2.9-1.3-.8-2.7-1.5-4.1-2 9.2-27.3 5.6-54.5-3.7-79.1-11.4-30.1-31.3-56.4-46.5-74.4-17.1-21.5-33.7-41.9-33.4-72C311.1 85.4 315.7.1 234.8 0 132.4-.2 158 103.4 156.9 135.2c-1.7 23.4-6.4 41.8-22.5 64.7-18.9 22.5-45.5 58.8-58.1 96.7-6 17.9-8.8 36.1-6.2 53.3-6.5 5.8-11.4 14.7-16.6 20.2-4.2 4.3-10.3 5.9-17 8.3s-14 6-18.5 14.5c-2.1 3.9-2.8 8.1-2.8 12.4 0 3.9.6 7.9 1.2 11.8 1.2 8.1 2.5 15.7.8 20.8-5.2 14.4-5.9 24.4-2.2 31.7 3.8 7.3 11.4 10.5 20.1 12.3 17.3 3.6 40.8 2.7 59.3 12.5 19.8 10.4 39.9 14.1 55.9 10.4 11.6-2.6 21.1-9.6 25.9-20.2 12.5-.1 26.3-5.4 48.3-6.6 14.9-1.2 33.6 5.3 55.1 4.1.6 2.3 1.4 4.6 2.5 6.7v.1c8.3 16.7 23.8 24.3 40.3 23 16.6-1.3 34.1-11 48.3-27.9 13.6-16.4 36-23.2 50.9-32.2 7.4-4.5 13.4-10.1 13.9-18.3.4-8.2-4.4-17.3-15.5-29.7zM223.7 87.3c9.8-22.2 34.2-21.8 44-.4 6.5 14.2 3.6 30.9-4.3 40.4-1.6-.8-5.9-2.6-12.6-4.9 1.1-1.2 3.1-2.7 3.9-4.6 4.8-11.8-.2-27-9.1-27.3-7.3-.5-13.9 10.8-11.8 23-4.1-2-9.4-3.5-13-4.4-1-6.9-.3-14.6 2.9-21.8zM183 75.8c10.1 0 20.8 14.2 19.1 33.5-3.5 1-7.1 2.5-10.2 4.6 1.2-8.9-3.3-20.1-9.6-19.6-8.4.7-9.8 21.2-1.8 28.1 1 .8 1.9-.2-5.9 5.5-15.6-14.6-10.5-52.1 8.4-52.1zm-13.6 60.7c6.2-4.6 13.6-10 14.1-10.5 4.7-4.4 13.5-14.2 27.9-14.2 7.1 0 15.6 2.3 25.9 8.9 6.3 4.1 11.3 4.4 22.6 9.3 8.4 3.5 13.7 9.7 10.5 18.2-2.6 7.1-11 14.4-22.7 18.1-11.1 3.6-19.8 16-38.2 14.9-3.9-.2-7-1-9.6-2.1-8-3.5-12.2-10.4-20-15-8.6-4.8-13.2-10.4-14.7-15.3-1.4-4.9 0-9 4.2-12.3zm3.3 334c-2.7 35.1-43.9 34.4-75.3 18-29.9-15.8-68.6-6.5-76.5-21.9-2.4-4.7-2.4-12.7 2.6-26.4v-.2c2.4-7.6.6-16-.6-23.9-1.2-7.8-1.8-15 .9-20 3.5-6.7 8.5-9.1 14.8-11.3 10.3-3.7 11.8-3.4 19.6-9.9 5.5-5.7 9.5-12.9 14.3-18 5.1-5.5 10-8.1 17.7-6.9 8.1 1.2 15.1 6.8 21.9 16l19.6 35.6c9.5 19.9 43.1 48.4 41 68.9zm-1.4-25.9c-4.1-6.6-9.6-13.6-14.4-19.6 7.1 0 14.2-2.2 16.7-8.9 2.3-6.2 0-14.9-7.4-24.9-13.5-18.2-38.3-32.5-38.3-32.5-13.5-8.4-21.1-18.7-24.6-29.9s-3-23.3-.3-35.2c5.2-22.9 18.6-45.2 27.2-59.2 2.3-1.7.8 3.2-8.7 20.8-8.5 16.1-24.4 53.3-2.6 82.4.6-20.7 5.5-41.8 13.8-61.5 12-27.4 37.3-74.9 39.3-112.7 1.1.8 4.6 3.2 6.2 4.1 4.6 2.7 8.1 6.7 12.6 10.3 12.4 10 28.5 9.2 42.4 1.2 6.2-3.5 11.2-7.5 15.9-9 9.9-3.1 17.8-8.6 22.3-15 7.7 30.4 25.7 74.3 37.2 95.7 6.1 11.4 18.3 35.5 23.6 64.6 3.3-.1 7 .4 10.9 1.4 13.8-35.7-11.7-74.2-23.3-84.9-4.7-4.6-4.9-6.6-2.6-6.5 12.6 11.2 29.2 33.7 35.2 59 2.8 11.6 3.3 23.7.4 35.7 16.4 6.8 35.9 17.9 30.7 34.8-2.2-.1-3.2 0-4.2 0 3.2-10.1-3.9-17.6-22.8-26.1-19.6-8.6-36-8.6-38.3 12.5-12.1 4.2-18.3 14.7-21.4 27.3-2.8 11.2-3.6 24.7-4.4 39.9-.5 7.7-3.6 18-6.8 29-32.1 22.9-76.7 32.9-114.3 7.2zm257.4-11.5c-.9 16.8-41.2 19.9-63.2 46.5-13.2 15.7-29.4 24.4-43.6 25.5s-26.5-4.8-33.7-19.3c-4.7-11.1-2.4-23.1 1.1-36.3 3.7-14.2 9.2-28.8 9.9-40.6.8-15.2 1.7-28.5 4.2-38.7 2.6-10.3 6.6-17.2 13.7-21.1.3-.2.7-.3 1-.5.8 13.2 7.3 26.6 18.8 29.5 12.6 3.3 30.7-7.5 38.4-16.3 9-.3 15.7-.9 22.6 5.1 9.9 8.5 7.1 30.3 17.1 41.6 10.6 11.6 14 19.5 13.7 24.6zM173.3 148.7c2 1.9 4.7 4.5 8 7.1 6.6 5.2 15.8 10.6 27.3 10.6 11.6 0 22.5-5.9 31.8-10.8 4.9-2.6 10.9-7 14.8-10.4s5.9-6.3 3.1-6.6-2.6 2.6-6 5.1c-4.4 3.2-9.7 7.4-13.9 9.8-7.4 4.2-19.5 10.2-29.9 10.2s-18.7-4.8-24.9-9.7c-3.1-2.5-5.7-5-7.7-6.9-1.5-1.4-1.9-4.6-4.3-4.9-1.4-.1-1.8 3.7 1.7 6.5z"/></svg></span> Linux operating system with a <a href=https://developer.nvidia.com/nvidia-video-codec-sdk><strong>supported NVIDIA GPU</strong></a>.</li> <li> <p>You're using FFmpeg 4.4 or newer, configured with at least <code>--enable-nonfree --enable-cuda-nvcc --enable-libnpp --enable-cuvid --enable-nvenc</code> configuration flags during compilation. For compilation follow <a href=https://docs.nvidia.com/video-technologies/video-codec-sdk/ffmpeg-with-nvidia-gpu/#prerequisites>these instructions ➶</a></p> <details class=danger> <summary>Verifying NVDEC/CUDA support in FFmpeg</summary> <p>To use CUDA Video-decoder(<code>cuda</code>), remember to check if your FFmpeg compiled with it by executing following commands in your terminal, and observing if output contains something similar as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>$<span class=w> </span>ffmpeg<span class=w>  </span>-hide_banner<span class=w> </span>-pix_fmts<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>cuda
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>..H..<span class=w> </span>cuda<span class=w>                   </span><span class=m>0</span><span class=w>              </span><span class=m>0</span><span class=w>      </span><span class=m>0</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>$<span class=w> </span>ffmpeg<span class=w>  </span>-hide_banner<span class=w> </span>-filters<span class=w> </span><span class=p>|</span><span class=w> </span>egrep<span class=w> </span><span class=s2>&quot;cuda|npp&quot;</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>...<span class=w> </span>bilateral_cuda<span class=w>    </span>V-&gt;V<span class=w>       </span>GPU<span class=w> </span>accelerated<span class=w> </span>bilateral<span class=w> </span>filter
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>...<span class=w> </span>chromakey_cuda<span class=w>    </span>V-&gt;V<span class=w>       </span>GPU<span class=w> </span>accelerated<span class=w> </span>chromakey<span class=w> </span>filter
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>...<span class=w> </span>colorspace_cuda<span class=w>   </span>V-&gt;V<span class=w>       </span>CUDA<span class=w> </span>accelerated<span class=w> </span>video<span class=w> </span>color<span class=w> </span>converter
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>...<span class=w> </span>hwupload_cuda<span class=w>     </span>V-&gt;V<span class=w>       </span>Upload<span class=w> </span>a<span class=w> </span>system<span class=w> </span>memory<span class=w> </span>frame<span class=w> </span>to<span class=w> </span>a<span class=w> </span>CUDA<span class=w> </span>device.
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>...<span class=w> </span>overlay_cuda<span class=w>      </span>VV-&gt;V<span class=w>      </span>Overlay<span class=w> </span>one<span class=w> </span>video<span class=w> </span>on<span class=w> </span>top<span class=w> </span>of<span class=w> </span>another<span class=w> </span>using<span class=w> </span>CUDA
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>...<span class=w> </span>scale_cuda<span class=w>        </span>V-&gt;V<span class=w>       </span>GPU<span class=w> </span>accelerated<span class=w> </span>video<span class=w> </span>resizer
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>...<span class=w> </span>scale_npp<span class=w>         </span>V-&gt;V<span class=w>       </span>NVIDIA<span class=w> </span>Performance<span class=w> </span>Primitives<span class=w> </span>video<span class=w> </span>scaling<span class=w> </span>and<span class=w> </span>format<span class=w> </span>conversion
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>...<span class=w> </span>scale2ref_npp<span class=w>     </span>VV-&gt;VV<span class=w>     </span>NVIDIA<span class=w> </span>Performance<span class=w> </span>Primitives<span class=w> </span>video<span class=w> </span>scaling<span class=w> </span>and<span class=w> </span>format<span class=w> </span>conversion<span class=w> </span>to<span class=w> </span>the<span class=w> </span>given<span class=w> </span>reference.
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>...<span class=w> </span>sharpen_npp<span class=w>       </span>V-&gt;V<span class=w>       </span>NVIDIA<span class=w> </span>Performance<span class=w> </span>Primitives<span class=w> </span>video<span class=w> </span>sharpening<span class=w> </span>filter.
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>...<span class=w> </span>thumbnail_cuda<span class=w>    </span>V-&gt;V<span class=w>       </span>Select<span class=w> </span>the<span class=w> </span>most<span class=w> </span>representative<span class=w> </span>frame<span class=w> </span><span class=k>in</span><span class=w> </span>a<span class=w> </span>given<span class=w> </span>sequence<span class=w> </span>of<span class=w> </span>consecutive<span class=w> </span>frames.
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>...<span class=w> </span>transpose_npp<span class=w>     </span>V-&gt;V<span class=w>       </span>NVIDIA<span class=w> </span>Performance<span class=w> </span>Primitives<span class=w> </span>video<span class=w> </span>transpose
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>T..<span class=w> </span>yadif_cuda<span class=w>        </span>V-&gt;V<span class=w>       </span>Deinterlace<span class=w> </span>CUDA<span class=w> </span>frames
</code></pre></div> </details> </li> <li> <p>You already have appropriate Nvidia video drivers and related softwares installed on your machine.</p> </li> <li>If the stream is not decodable in hardware (for example, it is an unsupported codec or profile) then it will still be decoded in software automatically, but hardware filters won't be applicable.</li> </ul> <p>These assumptions <strong>MAY/MAY NOT</strong> suit your current setup. Kindly use suitable parameters based your system platform and hardware settings only.</p> </details> <p>In this example, we will be using Nvidia's <strong>CUDA Internal hwaccel Video decoder(<code>cuda</code>)</strong> in FFdecoder API to automatically detect best NV-accelerated video codec and keeping video frames in GPU memory <em>(for applying hardware filters)</em>, thereby achieving GPU-accelerated decoding of <strong>NV12</strong> pixel-format frames from a given video file <em>(say <code>foo.mp4</code>)</em>, and preview them using OpenCV Library's <code>cv2.imshow()</code> method.</p> <details class=warning> <summary><code>NV12</code>(for <code>4:2:0</code> input) and <code>NV21</code>(for <code>4:4:4</code> input) are the only supported pixel format. You cannot change pixel format to any other since NV-accelerated video codec supports only them.</summary> <p>NV12 is a biplanar format with a full sized Y plane followed by a single chroma plane with weaved U and V values. NV21 is the same but with weaved V and U values. The 12 in NV12 refers to 12 bits per pixel. NV12 has a half width and half height chroma channel, and therefore is a 420 subsampling. NV16 is 16 bits per pixel, with half width and full height. aka 422. NV24 is 24 bits per pixel with full sized chroma channel. aka 444. Most NV12 functions allow the destination Y pointer to be NULL.</p> </details> <div class="admonition info"> <p class=admonition-title>With FFdecoder API, frames extracted with YUV pixel formats <em>(<code>yuv420p</code>, <code>yuv444p</code>, <code>nv12</code>, <code>nv21</code> etc.)</em> are generally incompatible with OpenCV APIs such as <code>imshow()</code>. But you can make them easily compatible by using exclusive <a href=../../reference/ffdecoder/params/#b-exclusive-parameters><code>-enforce_cv_patch</code></a> boolean attribute of its <code>ffparam</code> dictionary parameter.</p> </div> <div class="admonition note"> <p class=admonition-title>More information on Nvidia's GPU Accelerated Decoding can be found <a href=https://developer.nvidia.com/blog/nvidia-ffmpeg-transcoding-guide/ >here ➶</a></p> </div> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># import the necessary packages</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=kn>from</span> <span class=nn>deffcode</span> <span class=kn>import</span> <span class=n>FFdecoder</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=kn>import</span> <span class=nn>cv2</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=c1># define suitable FFmpeg parameter</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=n>ffparams</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>    <span class=s2>&quot;-vcodec&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>  <span class=c1># skip source decoder and let FFmpeg chose</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>    <span class=s2>&quot;-enforce_cv_patch&quot;</span><span class=p>:</span> <span class=kc>True</span> <span class=c1># enable OpenCV patch for YUV(NV12) frames</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>    <span class=s2>&quot;-ffprefixes&quot;</span><span class=p>:</span> <span class=p>[</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>        <span class=s2>&quot;-vsync&quot;</span><span class=p>,</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>        <span class=s2>&quot;0&quot;</span><span class=p>,</span>  <span class=c1># prevent duplicate frames</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>        <span class=s2>&quot;-hwaccel&quot;</span><span class=p>,</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>        <span class=s2>&quot;cuda&quot;</span><span class=p>,</span>  <span class=c1># accelerator</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>        <span class=s2>&quot;-hwaccel_output_format&quot;</span><span class=p>,</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>        <span class=s2>&quot;cuda&quot;</span><span class=p>,</span>  <span class=c1># output accelerator</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>    <span class=p>],</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>    <span class=s2>&quot;-custom_resolution&quot;</span><span class=p>:</span> <span class=s2>&quot;null&quot;</span><span class=p>,</span>  <span class=c1># discard source `-custom_resolution`</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>    <span class=s2>&quot;-framerate&quot;</span><span class=p>:</span> <span class=s2>&quot;null&quot;</span><span class=p>,</span>  <span class=c1># discard source `-framerate`</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>    <span class=s2>&quot;-vf&quot;</span><span class=p>:</span> <span class=s2>&quot;scale_cuda=640:360,&quot;</span>  <span class=c1># scale to 640x360 in GPU memory</span>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>    <span class=o>+</span> <span class=s2>&quot;fps=60.0,&quot;</span>  <span class=c1># framerate 60.0fps in GPU memory</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>    <span class=o>+</span> <span class=s2>&quot;hwdownload,&quot;</span>  <span class=c1># download hardware frames to system memory</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>    <span class=o>+</span> <span class=s2>&quot;format=nv12&quot;</span><span class=p>,</span>  <span class=c1># convert downloaded frames to NV12 pixel format</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=p>}</span>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a><span class=c1># initialize and formulate the decoder with `foo.mp4` source</span>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a><span class=n>decoder</span> <span class=o>=</span> <span class=n>FFdecoder</span><span class=p>(</span>
<a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>    <span class=s2>&quot;foo.mp4&quot;</span><span class=p>,</span>
<a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>    <span class=n>frame_format</span><span class=o>=</span><span class=s2>&quot;null&quot;</span><span class=p>,</span>  <span class=c1># discard source frame pixel format</span>
<a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>    <span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=c1># enable verbose output</span>
<a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>    <span class=o>**</span><span class=n>ffparams</span> <span class=c1># apply various params and custom filters</span>
<a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a><span class=p>)</span><span class=o>.</span><span class=n>formulate</span><span class=p>()</span>
<a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>
<a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a><span class=c1># grab the NV12 frame from the decoder</span>
<a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a><span class=k>for</span> <span class=n>frame</span> <span class=ow>in</span> <span class=n>decoder</span><span class=o>.</span><span class=n>generateFrame</span><span class=p>():</span>
<a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>
<a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>    <span class=c1># check if frame is None</span>
<a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>    <span class=k>if</span> <span class=n>frame</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>        <span class=k>break</span>
<a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a>
<a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>    <span class=c1># convert it to `BGR` pixel format,</span>
<a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>    <span class=c1># since imshow() method only accepts `BGR` frames</span>
<a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>    <span class=n>frame</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>frame</span><span class=p>,</span> <span class=n>cv2</span><span class=o>.</span><span class=n>COLOR_YUV2BGR_NV12</span><span class=p>)</span>
<a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a>
<a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a>    <span class=c1># {do something with the BGR frame here}</span>
<a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a>
<a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a>    <span class=c1># Show output window</span>
<a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a>    <span class=n>cv2</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=s2>&quot;Output&quot;</span><span class=p>,</span> <span class=n>frame</span><span class=p>)</span>
<a id=__codelineno-4-48 name=__codelineno-4-48 href=#__codelineno-4-48></a>
<a id=__codelineno-4-49 name=__codelineno-4-49 href=#__codelineno-4-49></a>    <span class=c1># check for &#39;q&#39; key if pressed</span>
<a id=__codelineno-4-50 name=__codelineno-4-50 href=#__codelineno-4-50></a>    <span class=n>key</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>waitKey</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>
<a id=__codelineno-4-51 name=__codelineno-4-51 href=#__codelineno-4-51></a>    <span class=k>if</span> <span class=n>key</span> <span class=o>==</span> <span class=nb>ord</span><span class=p>(</span><span class=s2>&quot;q&quot;</span><span class=p>):</span>
<a id=__codelineno-4-52 name=__codelineno-4-52 href=#__codelineno-4-52></a>        <span class=k>break</span>
<a id=__codelineno-4-53 name=__codelineno-4-53 href=#__codelineno-4-53></a>
<a id=__codelineno-4-54 name=__codelineno-4-54 href=#__codelineno-4-54></a><span class=c1># close output window</span>
<a id=__codelineno-4-55 name=__codelineno-4-55 href=#__codelineno-4-55></a><span class=n>cv2</span><span class=o>.</span><span class=n>destroyAllWindows</span><span class=p>()</span>
<a id=__codelineno-4-56 name=__codelineno-4-56 href=#__codelineno-4-56></a>
<a id=__codelineno-4-57 name=__codelineno-4-57 href=#__codelineno-4-57></a><span class=c1># terminate the decoder</span>
<a id=__codelineno-4-58 name=__codelineno-4-58 href=#__codelineno-4-58></a><span class=n>decoder</span><span class=o>.</span><span class=n>terminate</span><span class=p>()</span>
</code></pre></div> <p>&nbsp;</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 10, 2023</span> </small> </div> <footer class=sponsorship> <hr> <a href=https://ko-fi.com/W7W8WTYO> <span class="twemoji heart-throb-hover"> <img alt=❤ class="twemoji heart" src=https://twemoji.maxcdn.com/v/latest/svg/2764.svg title=Donate> </span> </a> <hr> </footer> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021 Abhishek Thakur(@abhiTronix) </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/abhiTronix target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://gitter.im/deffcode-python/community target=_blank rel=noopener title=gitter.im class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"/></svg> </a> <a href=https://www.linkedin.com/in/abhishek-singh-thakur-a37845a5 target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://dev.to/abhitronix target=_blank rel=noopener title=dev.to class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.annotate", "content.code.copy", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.ba449ae6.min.js></script> <script src=../../../assets/javascripts/extra.js></script> </body> </html>